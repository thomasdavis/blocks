---
title: Visual Validation
description: Screenshot-based validation using deterministic tools and AI vision analysis
---

# Visual Validation

Visual validators analyze rendered HTML through screenshots to validate color contrast, readability, visual hierarchy, and layout integrity across different viewports.

## Overview

Visual validation complements source code analysis by validating what users actually see:

- **Color Contrast** - WCAG AA/AAA compliance (4.5:1, 7:1 ratios)
- **Text Readability** - Font sizes, line heights, spacing
- **Visual Hierarchy** - Clear distinction between headings
- **Layout Integrity** - No overlapping, proper spacing
- **Responsive Design** - Works across mobile, tablet, desktop

## Two-Layer Approach

Blocks provides **hybrid validation** combining deterministic and AI-powered analysis:

### Layer 1: Deterministic (axe-core)

Fast, precise WCAG compliance checking:

```yaml
validators:
  visual:
    - id: accessibility
      run: "visual.axe.v1"
```

**Checks:**
- Color contrast ratios (mathematical precision)
- ARIA attributes
- Semantic HTML structure
- Heading hierarchy
- Form labels

**Pros:** Fast (~2s), precise, no AI costs
**Cons:** Doesn't understand visual context

### Layer 2: AI Vision (GPT-4o)

Holistic readability and UX validation:

```yaml
validators:
  visual:
    - id: visual_analysis
      run: "visual.vision.v1"
```

**Checks:**
- Holistic color contrast (not just mathematical)
- Visual hierarchy and flow
- Element visibility
- Spacing and layout quality
- Cross-viewport consistency

**Pros:** Catches UX issues, understands context
**Cons:** Slower (~3-5s/viewport), costs ~$0.01/image

## Configuration

### Basic Setup

Add visual validation to your block:

```yaml
# blocks.yml
ai:
  provider: "openai"
  model: "gpt-4o-mini"  # Cheaper for visual validation

blocks:
  theme.modern_professional:
    description: "Modern professional resume theme"
    test_data: "test-data/sample-resume.json"
    visual_validation:
      viewports:
        - { width: 320, height: 568, name: "mobile" }
        - { width: 768, height: 1024, name: "tablet" }
        - { width: 1024, height: 768, name: "desktop" }
      rules:
        - "Text must be readable on all backgrounds"
        - "WCAG AA contrast minimum (4.5:1)"
        - "Clear visual hierarchy between headings"

validators:
  visual:
    - id: axe_check
      run: "visual.axe.v1"
    - id: vision_check
      run: "visual.vision.v1"
```

### Advanced Configuration

Use different AI models for different blocks:

```yaml
blocks:
  theme.creative:
    visual_validation:
      viewports:
        - { width: 375, height: 812, name: "mobile_modern" }
        - { width: 1920, height: 1080, name: "desktop_large" }
      rules:
        - "Bold typography with high visual impact"
        - "WCAG AAA contrast for critical text (7:1)"
      enabled: true  # Explicitly enable

validators:
  visual:
    - id: vision_strict
      run: "visual.vision.v1"
      config:
        model: "gpt-4o"  # Higher quality for strict validation
```

## Usage

### Running Visual Validation

```bash
# Validate single block with visual checks
blocks run theme.modern_professional

# Skip visual validation (faster during development)
blocks run theme.modern_professional --skip-visual

# Visual validation only
blocks run theme.modern_professional --only-visual
```

### Example Output

```
ðŸ“¦ Validating: theme.modern_professional

  âœ“ schema ok
  âœ“ shape ok
  âœ“ domain ok

  ðŸ“¸ Visual validation...

  [axe-core accessibility]
  âœ“ Color contrast passes WCAG AA
  âœ“ ARIA attributes present
  âœ“ Heading hierarchy correct (h1 â†’ h2 â†’ h3)
  âš  [WARNING] Missing aria-label on navigation

  [AI vision - mobile viewport]
  âœ“ Text readable on all backgrounds
  âœ“ Layout fits within 320px viewport
  âš  [WARNING] Section spacing tight on mobile

  [AI vision - tablet viewport]
  âœ“ Visual hierarchy clear
  âœ“ No overlapping elements

  [AI vision - desktop viewport]
  âœ“ All elements clearly visible
  âœ“ Professional appearance maintained

  âš  Block has 2 warnings

ðŸ’¡ Suggestions:
  - Add aria-label="Main navigation" to nav element
  - Increase section margin-bottom to 2rem on mobile
```

## Programmatic Usage

### Using AxeValidator

```typescript
import { AxeValidator } from '@blocksai/visual-validators';

const axe = new AxeValidator();

const html = `
<!DOCTYPE html>
<html>
  <body>
    <h1>Resume Title</h1>
    <p style="color: #666; background: #fff;">
      This text has good contrast (4.5:1)
    </p>
  </body>
</html>
`;

const result = await axe.validate(html);

console.log(result.valid); // true or false
console.log(result.issues); // Array of issues with severity
```

### Using VisionValidator

```typescript
import { VisionValidator } from '@blocksai/visual-validators';
import { AIProvider } from '@blocksai/ai';

const ai = new AIProvider({
  provider: 'openai',
  model: 'gpt-4o-mini'
});

const vision = new VisionValidator(ai);

const result = await vision.validate({
  html,
  blockName: 'theme.modern_professional',
  viewports: [
    { width: 320, height: 568, name: 'mobile' },
    { width: 1024, height: 768, name: 'desktop' },
  ],
  visualRules: [
    'WCAG AA contrast minimum',
    'Clear visual hierarchy'
  ],
  philosophy: [
    'Resume themes must prioritize readability'
  ]
});

// Issues grouped by viewport
for (const issue of result.issues) {
  console.log(`[${issue.viewport}] ${issue.message}`);
}
```

### Custom Screenshot Capture

```typescript
import { ScreenshotCapture } from '@blocksai/visual-validators';

const capture = new ScreenshotCapture();
await capture.initialize();

try {
  const screenshots = await capture.captureMultiple(html, [
    { width: 320, height: 568, name: 'mobile' },
    { width: 1024, height: 768, name: 'desktop' },
  ]);

  for (const { buffer, viewport } of screenshots) {
    // Save or analyze screenshot
    fs.writeFileSync(`${viewport.name}.png`, buffer);
  }
} finally {
  await capture.close();
}
```

## Integration Patterns

### CI/CD Pipeline

Add visual validation to GitHub Actions:

```yaml
name: Validate Blocks

on: [pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3

      - name: Install dependencies
        run: pnpm install

      - name: Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: Run visual validation
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: blocks run --all

      - name: Upload screenshots on failure
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: screenshots
          path: .blocks/screenshots/*.png
```

### Pre-commit Hook

Validate before committing:

```bash
# .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Run visual validation on changed blocks
blocks run --changed --skip-visual || {
  echo "Visual validation failed. Run with --visual to see details."
  exit 1
}
```

## Cost Optimization

### Use Cheaper Models for Development

```yaml
ai:
  provider: "openai"
  model: "gpt-4o-mini"  # ~$0.01 per image
```

### Upgrade for Production

```yaml
validators:
  visual:
    - id: vision_prod
      run: "visual.vision.v1"
      config:
        model: "gpt-4o"  # ~$0.05 per image, higher quality
```

### Cache Screenshots

Only re-validate when templates change:

```bash
# Skip visual if template unchanged
blocks run theme.modern_professional --cache-visual
```

## Viewport Presets

Common viewport configurations:

### Mobile-First

```yaml
visual_validation:
  viewports:
    - { width: 320, height: 568, name: "mobile_small" }
    - { width: 375, height: 812, name: "mobile_modern" }
    - { width: 768, height: 1024, name: "tablet" }
```

### Desktop-Focused

```yaml
visual_validation:
  viewports:
    - { width: 1024, height: 768, name: "laptop" }
    - { width: 1440, height: 900, name: "desktop" }
    - { width: 1920, height: 1080, name: "large_desktop" }
```

### Print-Optimized

```yaml
visual_validation:
  viewports:
    - { width: 816, height: 1056, name: "letter" }  # 8.5x11" at 96dpi
    - { width: 794, height: 1123, name: "a4" }      # A4 at 96dpi
```

## Troubleshooting

### "Playwright not installed"

```bash
pnpm add -D playwright
npx playwright install chromium
```

### "Screenshot timeout"

Increase wait time for complex pages:

```typescript
// In ScreenshotCapture
await page.waitForTimeout(1000); // Instead of 500ms
```

### "False positives from AI"

Use deterministic validators for precise checks:

```yaml
validators:
  visual:
    - id: axe_contrast
      run: "visual.axe.v1"  # Precise, no false positives
```

### "Too slow in CI"

Run visual validation only on changed blocks:

```bash
blocks run --changed --only-visual
```

## Best Practices

1. **Combine Both Approaches**
   - Use axe-core for precise WCAG compliance
   - Use AI vision for holistic readability

2. **Test Multiple Viewports**
   - Mobile (320px, 375px)
   - Tablet (768px)
   - Desktop (1024px+)

3. **Use Cheap Models for Development**
   - GPT-4o-mini for fast iteration
   - GPT-4o for production validation

4. **Cache Aggressively**
   - Only re-validate when templates change
   - Save screenshots for debugging

5. **Document Visual Rules**
   - Write specific, testable rules
   - Align with design system

## Next Steps

- [Configure AI providers](/docs/getting-started/ai-configuration) for vision models
- [See resume themes example](/docs/examples/json-resume-themes) with visual validation
- [Learn about validators](/docs/core-concepts/validators) architecture
